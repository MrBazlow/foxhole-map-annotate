{% extends "base.html" %}

{% block css %}
{# <script src="/dist/index.css"></script> #}
{% endblock %}

{% block javascript %}
<script src="/dist/index.js?{{ cacheBuster }}"></script>
{% endblock %}

{# Center score card #}
{% block scoreCard %}
<div class="lg:flex flex-row select-none absolute mx-auto left-0 right-0 w-fit h-10 hidden">
    <div class="bg-zinc-800 flex flex-row items-center rounded-l-xl h-10 pr-4 shadow-inner">
        <img class="pl-3 w-fit" height="40" width="38" src="/images/colonial.webp" alt="Colonial" loading="lazy">
        <div class="text-xl font-semibold pl-3">
            <span id="colonial-score"></span>/<span class="total-score"></span>
        </div>
    </div>
    <div class="bg-zinc-800 flex flex-row items-center rounded-r-xl h-10 pl-4 shadow-inner">
        <div class="text-xl font-semibold pr-3">
            <span id="warden-score"></span>/<span class="total-score"></span>
        </div>
        <img class="pr-3 w-fit" height="40" width="38" src="/images/warden.webp" alt="Warden" loading="lazy">
    </div>
</div>
{% endblock %}

{# Map zoom controls #}
{% block mapControls %}
<div x-data  id="ol-zoom-control" class="absolute flex flex-col m-2 w-fit">
    <button id="ol-zoom-in" @click.prevent.throttle.300ms="$store.mapZoom.in()" class="px-1.5 bg-warden-700 active:bg-warden-900 rounded-t-md transition hover:scale-105 active:scale-95 select-none" type="button" title="Zoom in" aria-label="Zoom in">+</button>
    <button id="ol-zoom-out" @click.prevent.throttle.300ms="$store.mapZoom.out()" class="px-1.5 bg-warden-700 active:bg-warden-900 rounded-b-md transition hover:scale-105 active:scale-95 select-none" type="button" title="Zoom out" aria-label="Zoom out">â€“</button>
</div>
{% endblock%}

{% block mapLayerTools %}
<!-- WIP BUGGY MESS RIGHT NOW -->
<!-- Search -->
<div class="inline-flex group">
    <input type="search" id="search-dropdown" class="block pl-2 py-2 w-full rounded-l-lg text-sm origin-right transition bg-zinc-800 placeholder-gray-400 text-white scale-x-0 group-focus:scale-x-100 group-hover:scale-x-100 border-0 ring-0 focus:border-0 focus:ring-0" placeholder="#TODO..." tabindex="0">
    <button href="###" class="group bg-transparent px-2 py-2 mx-2 rounded-r-lg rounded-l-lg group-focus:rounded-l-none group-focus:bg-warden-600 group-hover:rounded-l-none group-hover:bg-warden-600 active:scale-95 transition duration-200 text-lg font-light hidden md:inline">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 transition duration-200 group-hover:scale-125">
            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
        </svg>
    </button>
</div>
<!-- TODO -->
<!-- Layers Toggle Menu -->
<button href="#" class="group bg-transparent px-2 py-2 mx-2 rounded-lg hover:bg-warden-600 active:scale-95 transition duration-200 text-lg font-light hidden md:inline">
    <div class="layerSwitcher"></div>
    <!-- Layers -->
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 transition duration-200 group-hover:scale-125">
        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 11-3 0m3 0a1.5 1.5 0 10-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-9.75 0h9.75" />
        </svg>                      
</button>
{% endblock %}

{% block content %}
<div id="map" class="flex-none h-full w-full">
</div>
<div id="global-alerts">
    <div id="disconnected" class="alert alert-danger mb-2">Connection to server lost. Auto-reconnect in 10s. Map doesn't
        update automatically. Editing not possible. Refresh page if message doesn't disappear.</div>
    <div id="resistance"
        class="alert {% if warStatus === 'resistance' and warWinner === 'Colonial' %}alert-warning{% elseif warStatus === 'resistance' and warWinner === 'Warden' %}alert-success{% endif %}"
        {% if warStatus !=='resistance' %}style="display: none" {% endif %}>
        <p>War is over. Winner: <strong id="resistance-winner">{{ warWinner }}</strong></p>
        <p id="resistance-COLONIALS" {% if warWinner===config.basic.faction %}style="display: none" {% endif %}>We lost.
            We will get them next time!</p>
        <p id="resistance-WARDENS" {% if warWinner !==config.basic.faction %}style="display: none" {% endif %}>We won!
            Congratulations! Now go to sleep.</p>
        <p class="mb-0">Map is now read-only. Goes in preparation mode for next war <span id="resistance-timer"
                data-conquest-end-time="{{ warConquestEndTime }}"></span>.</p>
    </div>
</div>
<div id="feature-info">

    {# <div id="mouse-position-content" class="debug bg-light text-bg-light container mb-2">#}
        {# <div class="row mb-2 mt-2">#}
            {# <span class="col-sm-3">Mouse</span>#}
            {# <div id="mouse-position" class="col-sm-9"></div>#}
            {# </div>#}
        {# </div>#}

    <div id="icon-info" class="info-box bg-light text-bg-light p-1 px-2">
        <div class="placementInfo row align-items-center justify-content-between">
            <div class="user col-auto"></div>
            <div class="time col-auto">
                <span class="clock"><span class="clock-time"></span>{% include 'clock.svg' %}</span>
                <i class="bi bi-flag flag" title="Flag for moderator check"></i>
            </div>
        </div>
        <div class="notes col-auto"></div>
    </div>
</div>

{#
    Wrapper for ALL map editing. Arty, Edit, Flags etc. X-data it.  
#}
{% from "tool-interface.html" import editToolWindow, artyToolWindow, flagToolWindow %}
<div x-data="windows">
    {% include 'speed-dial.html' %}
    <div x-cloak x-show="artyView" class="" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" x-transition:leave="transition ease-in duration-300" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0">
        {{ artyToolWindow() }}
    </div>
    <div x-cloak x-show="editView" class="" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" x-transition:leave="transition ease-in duration-300" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0">
        {{ editToolWindow() }}
    </div>
    <div x-cloak x-show="flagView" class="" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" x-transition:leave="transition ease-in duration-300" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0">
        {{ flagToolWindow() }}
        Hello
    </div>
</div>
<template id="flaggedTemplate">
    <tr class="flagged-item">
        <td class="icon"></td>
        <td class="user"></td>
        <!--<td class="notes"></td>-->
        <td class="flagCount"></td>
        <td>
            <div class="btn-group">
            <a href="#" class="target btn btn-light"><i class="bi bi-arrows-move"></i></a>
            <a href="#" class="delete btn btn-danger"><i class="bi bi-trash"></i></a>
            </div>
        </td>
    </tr>
</template>



{#% include 'sidebar-edit.html' %#}

{#% include 'sidebar-arty.html' %#}

{#
    <div class="offcanvas offcanvas-start faction-background-color" tabindex="-1" id="flags" aria-labelledby="flagsLabel">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="flagsLabel">Flags</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <template id="flaggedTemplate">
                <tr class="flagged-item">
                    <td class="icon"></td>
                    <td class="user"></td>
                    <!--<td class="notes"></td>-->
                    <td class="flagCount"></td>
                    <td>
                        <div class="btn-group">
                        <a href="#" class="target btn btn-light"><i class="bi bi-arrows-move"></i></a>
                        <a href="#" class="delete btn btn-danger"><i class="bi bi-trash"></i></a>
                        </div>
                    </td>
                </tr>
            </template>
            <table id="flagged" class="col-12">
                <thead>
                    <tr>
                        <td colspan="2">User</td>
                        <!--<td>Notes</td>-->
                        <td style="min-width: 3em">Count</td>
                        <td></td>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
#}
{% endblock %}